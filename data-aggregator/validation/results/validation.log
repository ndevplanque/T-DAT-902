2025-04-11 13:38:55,964 - INFO - Démarrage de la validation des données agrégées
2025-04-11 13:38:55,967 - INFO - Connexion à MongoDB réussie
Test d'écriture du log
2025-04-11 13:53:35,155 - INFO - Logging configuré avec succès. Fichier de log: /app/results/validation.log
2025-04-11 13:53:35,155 - INFO - Démarrage de la validation des données agrégées
2025-04-11 13:53:35,155 - INFO - Répertoire de sortie: /app/results
2025-04-11 13:53:35,156 - INFO - Test d'écriture dans /app/results réussi
2025-04-11 13:53:35,156 - INFO - Connexion aux bases de données...
2025-04-11 13:53:35,157 - INFO - Tentative de connexion à MongoDB: mongodb://root:rootpassword@mongodb:27017/, DB: villes_france
2025-04-11 13:53:35,194 - INFO - Ping MongoDB réussi
2025-04-11 13:53:35,194 - INFO - Connexion à MongoDB réussie, base de données: villes_france
2025-04-11 13:53:35,194 - INFO - Test de MongoDB - Liste des collections:
2025-04-11 13:53:35,195 - INFO - Collections disponibles: ['regions_stats', 'avis', 'villes', 'mots_villes', 'departements_stats']
2025-04-11 13:53:35,195 - INFO - Tentative de connexion à PostgreSQL...
2025-04-11 13:53:35,195 - INFO - Paramètres de connexion PostgreSQL: host=postgres, port=5432, dbname=gis_db, user=postgres
2025-04-11 13:53:35,228 - INFO - Connexion à PostgreSQL réussie
2025-04-11 13:53:35,229 - INFO - Test de PostgreSQL - Liste des tables:
2025-04-11 13:53:35,331 - INFO - Tables disponibles: ['geography_columns', 'geometry_columns', 'spatial_ref_sys', 'regions', 'departments', 'cities']
2025-04-11 13:53:35,332 - INFO - Vérification des collections nécessaires...
2025-04-11 13:53:35,335 - INFO - Collections disponibles: ['regions_stats', 'avis', 'villes', 'mots_villes', 'departements_stats']
2025-04-11 13:53:35,336 - INFO - Toutes les collections sont disponibles: ['villes', 'avis', 'mots_villes', 'departements_stats', 'regions_stats']
2025-04-11 13:53:35,339 - INFO - Collections non vides: ['villes(1)', 'avis(1)', 'mots_villes(1)', 'departements_stats(1)', 'regions_stats(1)']
2025-04-11 13:53:35,339 - INFO - Début des validations...
2025-04-11 13:53:35,339 - INFO - Vérification des statistiques de base des collections...
2025-04-11 13:53:35,381 - INFO - Statistiques des collections:
2025-04-11 13:53:35,381 - INFO -   - villes: 34455 documents
2025-04-11 13:53:35,382 - INFO -   - avis: 54656 documents
2025-04-11 13:53:35,382 - INFO -   - mots_villes: 10353 documents
2025-04-11 13:53:35,382 - INFO -   - departements_stats: 94 documents
2025-04-11 13:53:35,382 - INFO -   - regions_stats: 12 documents
2025-04-11 13:53:35,383 - INFO - Statistiques de base vérifiées avec succès
2025-04-11 13:53:35,383 - INFO - Validation des agrégations par département...
2025-04-11 13:53:35,417 - INFO - Validation des départements: MongoDB=94, PostgreSQL=109, Cohérent=False
2025-04-11 13:53:35,419 - INFO - Structure des départements valide: True
2025-04-11 13:53:35,420 - INFO - Cohérence département-région: True
2025-04-11 13:53:35,421 - INFO - Agrégations par département validées avec succès
2025-04-11 13:53:35,421 - INFO - Validation des agrégations par région...
2025-04-11 13:53:35,422 - INFO - Validation des régions: MongoDB=12, PostgreSQL=26, Cohérent=False
2025-04-11 13:53:35,423 - INFO - Structure des régions valide: True
2025-04-11 13:53:35,425 - INFO - Cohérence du nombre de départements dans les régions: True
2025-04-11 13:53:35,427 - INFO - Agrégations par région validées avec succès
2025-04-11 13:53:35,427 - INFO - Validation des calculs d'agrégation...
2025-04-11 13:53:35,434 - INFO - Validation des notes et sentiments: {'notes_in_range_dept': True, 'notes_in_range_region': True, 'sentiments_percents_valid_dept': True, 'sentiments_percents_valid_region': True}
2025-04-11 13:53:35,434 - INFO - Calculs d'agrégation validés avec succès
2025-04-11 13:53:35,434 - INFO - Vérification de la cohérence entre niveaux...
2025-04-11 13:53:35,466 - INFO - Cohérence avis villes-départements: 49989 vs 49989, match=True
2025-04-11 13:53:35,466 - INFO - Cohérence nombre de villes: 34455 vs 5477, match=False
2025-04-11 13:53:35,467 - INFO - Cohérence avis départements-régions: 49989 vs 49989, match=True
2025-04-11 13:53:35,467 - INFO - Cohérence nombre de villes départements-régions: 5477 vs 5477, match=True
2025-04-11 13:53:35,467 - INFO - Cohérence entre niveaux vérifiée avec succès
2025-04-11 13:53:35,467 - INFO - Recherche d'anomalies...
2025-04-11 13:53:35,472 - INFO - Aucune anomalie de type 'depts_sans_villes' détectée
2025-04-11 13:53:35,475 - INFO - Aucune anomalie de type 'regions_sans_depts' détectée
2025-04-11 13:53:35,478 - INFO - Aucune anomalie de type 'depts_notes_extremes' détectée
2025-04-11 13:53:35,481 - INFO - Aucune anomalie de type 'regions_sentiments_extremes' détectée
2025-04-11 13:53:35,481 - INFO - Aucune anomalie de type 'mots_bizarres' détectée
2025-04-11 13:53:35,481 - INFO - Recherche d'anomalies terminée avec succès
2025-04-11 13:53:35,482 - INFO - Génération des visualisations...
2025-04-11 13:53:36,026 - INFO - Visualisations générées dans le répertoire /app/results
2025-04-11 13:53:36,026 - INFO - Visualisations générées avec succès
2025-04-11 13:53:36,026 - INFO - Exportation des statistiques au format JSON...
2025-04-11 13:53:36,054 - INFO - Statistiques exportées au format JSON: /app/results/stats_summary.json
2025-04-11 13:53:36,054 - INFO - Statistiques exportées avec succès
2025-04-11 13:53:36,054 - INFO - Génération du rapport de synthèse...
2025-04-11 13:53:36,057 - INFO - Rapport de validation généré: /app/results/rapport_validation.html
2025-04-11 13:53:36,057 - INFO - Rapport de synthèse généré avec succès
2025-04-11 13:53:36,057 - INFO - Validation des données agrégées terminée avec succès
2025-04-11 13:53:36,057 - INFO - Résultats disponibles dans le répertoire: /app/results
2025-04-11 13:53:36,058 - INFO - Connexion MongoDB fermée
2025-04-11 13:53:36,059 - INFO - Connexion PostgreSQL fermée
